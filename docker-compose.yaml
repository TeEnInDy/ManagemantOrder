version: '3.8'

services:
  # üóÑÔ∏è 1. Database (MariaDB)
  db:
    image: mariadb:10.6
    restart: always
    environment:
      MYSQL_ROOT_PASSWORD: root1234  # ‚ö†Ô∏è ‡∏ï‡∏±‡πâ‡∏á‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô DB ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
      MYSQL_DATABASE: ebizuke_db
    volumes:
      - db_data:/var/lib/mysql # ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏≤‡∏ß‡∏£ (‡∏õ‡∏¥‡∏î container ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏´‡∏≤‡∏¢)
    networks:
      - ebizuke-network

  # ‚öôÔ∏è 2. Backend API
  backend:
    build: ./backend
    restart: always
    ports:
      - "4000:4000"
    environment:
      # ‚ö†Ô∏è ‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏ï‡∏£‡∏á host ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏ä‡∏∑‡πà‡∏≠ service "db" ‡πÅ‡∏ó‡∏ô localhost
      DATABASE_URL: mysql://root:myrootpassword@db:3306/ebizuke_db
      JWT_SECRET: supersecretkey123
      PORT: 4000
    depends_on:
      - db
    volumes:
      - ./backend/uploads:/app/uploads # ‚úÖ Mount ‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå uploads ‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡∏Ç‡πâ‡∏≤‡∏á‡∏ô‡∏≠‡∏Å (‡∏£‡∏π‡∏õ‡πÑ‡∏°‡πà‡∏´‡∏≤‡∏¢)
    networks:
      - ebizuke-network

  # üé® 3. Frontend (Next.js)
  frontend:
    build: ./frontend
    restart: always
    ports:
      - "3000:3000"
    environment:
      # ‚ö†Ô∏è ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç! ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏™‡πà IP ‡∏Ç‡∏≠‡∏á Server ‡∏°‡∏´‡∏≤‡∏•‡∏±‡∏¢ (‡πÄ‡∏û‡∏£‡∏≤‡∏∞ Browser ‡∏¢‡∏¥‡∏á‡∏à‡∏≤‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏£‡∏≤ ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏à‡∏≤‡∏Å‡πÉ‡∏ô Docker)
      NEXT_PUBLIC_API_URL: http://IP_SERVER_‡∏Ç‡∏≠‡∏á‡∏ó‡πà‡∏≤‡∏ô:4000/api
    depends_on:
      - backend
    networks:
      - ebizuke-network

# ‡∏™‡∏£‡πâ‡∏≤‡∏á Network ‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ô‡πÄ‡∏≠‡∏á‡πÑ‡∏î‡πâ
networks:
  ebizuke-network:
    driver: bridge

# ‡∏™‡∏£‡πâ‡∏≤‡∏á Volume ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Database
volumes:
  db_data: