// 1. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// ==========================================
// üõí 1. ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (Product) - ‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏ô‡πâ‡∏≤‡∏£‡πâ‡∏≤‡∏ô
// ==========================================
model Product {
  id          Int      @id @default(autoincrement())
  name        String
  price       Decimal  @db.Decimal(10, 2)
  category    String   @default("General") // Main, Drink, Dessert
  description String?  @db.Text
  image       String?
  isActive    Boolean  @default(true) 
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  orderItems  OrderItem[]
  ingredients Recipe[]    // 1 ‡πÄ‡∏°‡∏ô‡∏π ‡∏°‡∏µ‡∏™‡πà‡∏ß‡∏ô‡∏ú‡∏™‡∏°‡∏≠‡∏∞‡πÑ‡∏£‡∏ö‡πâ‡∏≤‡∏á (Link ‡πÑ‡∏õ Stock)

  @@index([category, isActive]) // ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ï‡∏≤‡∏°‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡πÅ‡∏•‡∏∞‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÑ‡∏î‡πâ‡πÄ‡∏£‡πá‡∏ß
}

// ==========================================
// üì¶ 2. ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏ï‡πá‡∏≠‡∏Å (StockItem) - ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡∏´‡∏•‡∏±‡∏á‡∏ö‡πâ‡∏≤‡∏ô
// ==========================================
model StockItem {
  id                Int      @id @default(autoincrement())
  name              String    // ‡∏´‡∏°‡∏π‡∏™‡∏±‡∏ö, ‡∏Å‡∏∏‡πâ‡∏á, ‡πÅ‡∏Å‡πâ‡∏ß‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å
  category          String    @default("Raw Material") 
  quantity          Decimal   @db.Decimal(10, 2) // ‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠
  unit              String    // kg, g, ml, pcs
  costPerUnit       Decimal   @db.Decimal(10, 2) // ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢ (Average Cost)
  lowStockThreshold Int       @default(5) 

  // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°
  expiryDate        DateTime? 
  supplier          String?   

  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt

  // Relations
  usedInRecipes     Recipe[]  // ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡πÄ‡∏°‡∏ô‡∏π‡πÑ‡∏´‡∏ô‡∏ö‡πâ‡∏≤‡∏á
  stockLogs         StockLog[] // ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤-‡∏≠‡∏≠‡∏Å‡∏Ç‡∏≠‡∏á‡∏™‡∏ï‡πá‡∏≠‡∏Å (‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà)
}

// ==========================================
// üìú 2.2 ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏™‡∏ï‡πá‡∏≠‡∏Å (StockLog) - **‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà**
// ‡πÄ‡∏Å‡πá‡∏ö‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß (‡πÄ‡∏Ç‡πâ‡∏≤/‡∏≠‡∏≠‡∏Å/‡∏ó‡∏¥‡πâ‡∏á/‡πÉ‡∏ä‡πâ‡∏à‡∏£‡∏¥‡∏á)
// ==========================================
model StockLog {
  id          Int      @id @default(autoincrement())
  stockItemId Int
  stockItem   StockItem @relation(fields: [stockItemId], references: [id], onDelete: Cascade)
  
  type        StockLogType // USE, WASTE, RESTOCK, ADJUST
  amount      Decimal      @db.Decimal(10, 2) // ‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á (‡πÄ‡∏ä‡πà‡∏ô -0.5, +10)
  costAtTime  Decimal      @db.Decimal(10, 2) // ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô ‡∏ì ‡∏ï‡∏≠‡∏ô‡∏ô‡∏±‡πâ‡∏ô
  reason      String?      // ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ ‡πÄ‡∏ä‡πà‡∏ô "‡∏ó‡∏≥‡∏ô‡πâ‡∏≥‡∏à‡∏¥‡πâ‡∏°‡∏•‡πá‡∏≠‡∏ï‡πÄ‡∏ä‡πâ‡∏≤", "‡∏Å‡∏∏‡πâ‡∏á‡πÄ‡∏ô‡πà‡∏≤‡∏ó‡∏¥‡πâ‡∏á"
  
  createdAt   DateTime @default(now())

  @@index([stockItemId, type])
  @@index([createdAt])
}

// ==========================================
// üç≥ 2.5 ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏π‡∏ï‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£ (Recipe)
// ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏° Product ‡∏Å‡∏±‡∏ö Stock ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏±‡∏î‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
// ==========================================
model Recipe {
  id          Int      @id @default(autoincrement())
  productId   Int
  stockItemId Int
  quantity    Decimal  @db.Decimal(10, 2) // ‡πÉ‡∏ä‡πâ‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà‡∏ï‡πà‡∏≠ 1 ‡∏à‡∏≤‡∏ô

  product     Product   @relation(fields: [productId], references: [id], onDelete: Cascade)
  stockItem   StockItem @relation(fields: [stockItemId], references: [id], onDelete: Cascade)

  @@unique([productId, stockItemId]) // ‡∏´‡πâ‡∏≤‡∏°‡πÉ‡∏™‡πà‡∏ã‡πâ‡∏≥‡∏Ñ‡∏π‡πà‡πÄ‡∏î‡∏¥‡∏°
}

// ==========================================
// üßæ 3. ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå (Order)
// ==========================================
model Order {
  id               Int       @id @default(autoincrement())
  customerName     String?   @default("Walk-in")
  
  // Discord Integration
  discordUserId    String?
  discordChannelId String?
  
  // Financials
  totalAmount      Decimal   @db.Decimal(10, 2)
  paymentMethod    String?   // Cash, Transfer
  status           OrderStatus @default(Pending)
  note             String?   @db.Text
  slipImage        String?  // üÜï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏ô‡∏µ‡πâ (String ‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡πá‡∏ô null ‡πÑ‡∏î‡πâ)
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt

  // Relations
  items            OrderItem[]
  transaction      Transaction? // 1 ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå ‡∏°‡∏µ 1 ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö (Optional ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏≠‡∏≤‡∏à‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô)

  @@index([createdAt])      // ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏£‡πá‡∏ß (‡∏ó‡∏≥ Report)
  @@index([discordUserId])  // ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÑ‡∏î‡πâ‡πÄ‡∏£‡πá‡∏ß
  @@index([status])         // ‡∏î‡∏∂‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏™‡∏£‡πá‡∏à‡πÑ‡∏î‡πâ‡πÄ‡∏£‡πá‡∏ß
}

// ==========================================
// üçΩÔ∏è 4. ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå (OrderItem)
// ==========================================
model OrderItem {
  id          Int      @id @default(autoincrement())
  orderId     Int
  productId   Int?
  
  // Snapshot Data (‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å)
  productName String   
  quantity    Int
  priceAtTime Decimal  @db.Decimal(10, 2) 

  // Relations
  order       Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product     Product? @relation(fields: [productId], references: [id], onDelete: SetNull)
}

// ==========================================
// üí∞ 5. ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ (Transaction)
// ==========================================
model Transaction {
  id          Int             @id @default(autoincrement())
  type        TransactionType // INCOME, EXPENSE
  amount      Decimal         @db.Decimal(10, 2)
  category    String          // Sales, Stock Purchase, Salary
  description String?
  
  // Link ‡∏Å‡∏±‡∏ö Order (Optional)
  orderId     Int?            @unique // 1 Order ‡∏°‡∏µ‡πÑ‡∏î‡πâ‡πÅ‡∏Ñ‡πà 1 Transaction ‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô
  order       Order?          @relation(fields: [orderId], references: [id])

  createdAt   DateTime        @default(now())

  @@index([type, createdAt]) // ‡∏ó‡∏≥ Report ‡πÅ‡∏¢‡∏Å‡∏£‡∏±‡∏ö/‡∏à‡πà‡∏≤‡∏¢ ‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏£‡πá‡∏ß
}

// ==========================================
// üìå Enums (‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏á‡∏ó‡∏µ‡πà)
// ==========================================

enum OrderStatus {
  Pending   // ‡∏£‡∏≠‡∏Ñ‡∏¥‡∏ß
  Cooking   // ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥
  Completed // ‡πÄ‡∏™‡∏£‡πá‡∏à/‡πÄ‡∏™‡∏¥‡∏£‡πå‡∏ü‡πÅ‡∏•‡πâ‡∏ß
  Cancelled // ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
}

enum TransactionType {
  INCOME    // ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö
  EXPENSE   // ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢
}

enum StockLogType {
  USE       // ‡πÉ‡∏ä‡πâ‡∏ó‡∏≥‡∏≠‡∏≤‡∏´‡∏≤‡∏£
  WASTE     // ‡∏Ç‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢/‡∏ó‡∏¥‡πâ‡∏á
  RESTOCK   // ‡πÄ‡∏ï‡∏¥‡∏°‡∏Ç‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà
  ADJUST    // ‡∏õ‡∏£‡∏±‡∏ö‡∏¢‡∏≠‡∏î (‡∏ô‡∏±‡∏ö‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á)
}